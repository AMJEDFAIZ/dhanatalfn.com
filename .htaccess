#########################################################
# ملف: public_html/.htaccess
# هذا هو الملف الخارجي الذي يستقبل الطلب أولًا
# وظيفته الأساسية: إعادة توجيه كل شيء إلى مجلد public
#########################################################

<IfModule mod_rewrite.c>

    # السماح باتباع الروابط الرمزية (symlinks)
    Options +FollowSymLinks

    # تفعيل إعادة الكتابة
    RewriteEngine On
     # تحسينات SEO - إعادة التوجيه
    #####################################################

    # 0) فرض HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # 0.1) فرض non-www (اختياري - لتوحيد الدومين)
    RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
    RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

    #####################################################

    #####################################################
    # 1) استثناء أي طلب يبدأ بـ /public/
    #    (حتى لا يعاد توجيهه مرة أخرى)
    #####################################################

    RewriteCond %{REQUEST_URI} !^/public/

    #####################################################
    # 2) إذا كان الملف أو المجلد موجودًا فعليًا
    #    لا نعيد توجيهه
    #####################################################

    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f

    #####################################################
    # 3) إعادة توجيه كل شيء إلى مجلد public
    #####################################################

    RewriteRule ^(.*)$ /public/$1

    # توجيه الصفحة الرئيسية إلى public/index.php
    RewriteRule ^(/)?$ public/index.php [L]

</IfModule>

#########################################################
# 4) حماية الملفات الحساسة من الوصول المباشر
#########################################################

<FilesMatch "^(\.env|composer\.(json|lock)|package\.json|artisan|\.git|README\.md)">
    Order allow,deny
    Deny from all
</FilesMatch>

#########################################################
# 5) منع استعراض المجلدات عبر المتصفح
#########################################################

Options -Indexes

Options All
